1. Examine why so many subjects have sMRI_use_for_5ttgen_mcrib equal to 0? - has to be probably changed.
done

2. In dMRI_5ttgen make sure we prefer 1 over 0.5:
# If we have a session.tsv file, use this
if [ -f $sessionfile ]; then
    # Read $sessionfile and use entries to create relevant files
    {
	counter=0
	read
	while IFS= read -r line
	do
	    # check if the file/image has passed QC (qc_pass_fail = 4th column)
	    QCPass=`echo "$line" | awk '{ print $4 }'`

        if [ $QCPass == 1 ] || [ $QCPass  == 0.5 ] ; then
            #### Read flags in session.tsv file with corresponding column index
            ## Flag for use of sMRI in 5ttgen mcrib (sMRI_use_for_5ttgen_mcrib = 9th column)

            #NEW CODE START
            file=`echo "$line" | awk '{ print $3 }'`
            echo $file
            
            #if has MCRIB in name then select is as the file
            if echo "$file" | grep -q "MCRIB"; then
                echo "IS VALID"
                filebase=`basename $file .nii.gz`
                filedir=`dirname $file`
                let counter++
                if [ ! -f $datadir/anat/$filebase.mif.gz ]; then
                    cp $origdatadir/$filedir/$filebase.nii.gz $origdatadir/$filedir/$filebase.json $datadir/.
                fi
            else
                echo "IS NOT VALID"
            fi
done

3. revisit  sub23 sessionQC.

4. Add eddy_quad instruction to get the CNR plots too (preprocess) - DONE.

5. rerun pipeline for 1 subject and check if it is ok  - DONE.

6. group response function - add script, look into mrtrix documentation. - 

7. verify that CNR maps are created. -> check qc/quad. - DONE. 

8. Adapt visualisation script.  - DONE. 

9. Add NODDI analysis to pipeline.  - DONE.

19.10.2023.

10. Save noddi input parameters when we run the script. - DONE.

11. https://mrtrix.readthedocs.io/en/dev/concepts/afd_connectivity.html - read. - DONE

12. separate the subject selection process into structural(exmined visually) and diffusion(maybe change to eddy_qc report?)

13. Maybe reasess subjects that have dwi qc 0, but passes eddy qc - ARE WE TOO RESTRICTIVE? Try to do analysis

14. Process all subjects and do eddy SQUAD analysis

15. Write a script for basic statistical analysis for dMRI parameters along tracts(just V1 , whole occipital lobe,  parietal lobe)


2.11.2023.

16. Do 10M streamline tractography for both hemispheres s.t. thalamus is seed and cortex of same hemisphere is inclusion -DONE

17. remove union files from trACTOGRAPHY. -DONE

18. add exclusion criteria for tractography. -DONE
    use CC, contralatera white matter, brainstem, contralateral thalamus.

19. 
cat rawdata/sub-PMR*/ses-MR2/session_QC.tsv | grep dir-AP | grep dwi.nii
when this instructions have an 1 or 0.5 in 3rd column and in the 5th and 6th column they should have a 1 or 0.5 ( non - entry)
- when there is a - , then we should use sbref 
the bad b0 will be exchanged by a better from sbref

20. implement oversampling. -should be after response and before csd. Do it.

21. Copy atlases to code/atlases - DONE.

22. Calculate parameter values along tracts viewed as mask - DONE.  add that it stores the results as a csv file

23. calculate parameter values along tracts:
Assigning Diffusion Metrics to Tracts: You can use the tcksample command to sample various diffusion metrics along the streamlines. For example, to sample FA values along a tract, you would do something like:

bash
Copy code
tcksample tracts.tck fa.mif fa_values_per_streamline.txt
Analyzing Diffusion Metrics Along the Tract: The output from tcksample can be further analyzed to compute average values or to perform statistical analysis. This often involves custom scripts or using tools like tckstats.

24. Modify dMRI_tract extraction script so it accepts only subsets, n+(originals are not necessary) -DONE

25. do the filtering on the SPECIFIC thalamocortical tract we are interested in.!   - DONE

#should the grou template response function used for all tract generations?

26. Check if the current df saving routine for pandas is ok with loading from csv file.

27. Check the visualisation script that there is everything fine. Has anything to be added? Maybe the overlaps of noddi or something similar?

28. Make sure you don't use the filtering on already filtered tractogram. - DONE.

29. Fix teamviewer issu - DONE.
Are there thalamo-striate connections that run in the medial aspect of the lateral ventricle?
Are there any other thalamo-striate connections apart from the geniculo-striate projections?
What happens if we filter harder, with 1 % instead of 0.1 %?
Can we implement a tract-based parcellation of the thalamus?
Can we implement alternative ways of filtering the tractograms? Like Wilson et al with 80 % on TDI maps.

30. First we do the preprocessing step for all subjects -> then we do the squad analysis and select which subjects go into the pipeline ->
-> calculate individual response functions for all subjects -> calculate group response function (downstream scripts should point to this group response) -> downstream tasks

For this change the for loop for iteration so the outer loop are the steps and the inner are subjects

31.until tomorrow do the thalamocortical projection filtering for 10M and do the 100M whole brain tractography with filtering -DONE.

32. First paper should be correlation of thalamocortical connection strength to GA.(STPO) -try to correlate it with SS scoring system(should be affected in parietal region)
How to filter the extracted tracts: Extract tract based on ROI -> make track density image(TDI) and filter it based on threshold
https://community.mrtrix.org/t/segment-tracts-from-tdi/1956
"It also sounds as though you are strictly looking for a binary mask corresponding to the spatial extent of a particular bundle, as opposed to the streamlines themselves?

If this is the case, then the “simplest” approach is to extract streamlines of interest from the whole-brain tractogram (application of SIFT is not hugely influential in this context), generate a TDI from the extracted streamlines, and then apply a threshold to produce a binary mask."
extract -> tckmap -> mrthreshold

33. Make lookup tables for mapping and lobar for MCRIB2.0 atlas
